<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HandMaker</title>
<style>
body { min-width: 320px; overflow-x: auto; font-family: 'Inter', Arial, sans-serif; margin: 0; background: #E5DDFF; line-height: 1.6; }
.tabs { display: flex; justify-content: center; gap: 12px; padding: 20px 0; background: #CDBFFF; backdrop-filter: blur(5px); }
.tab { padding: 12px 30px; cursor: pointer; border: 2px solid #7C4DFF; border-radius: 25px; background: #5B3DBF; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.2); color: silver; }
.tab:hover { background: rgba(124,77,255,0.1); transform: translateY(-2px); }
.tab.active { background: #7C4DFF; color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
.tab-content { width: 64%; margin: 0 auto; padding: 25px; backdrop-filter: blur(10px); }
@media (max-width: 1024px) { .tab-content { width: 80%; } .item { width: 80%; } }
@media (max-width: 600px) { .tab-content { width: 90%; padding: 10px; } .item { min-width: 96%; } .buttons { min-width: 96%; } }
.hidden { display: none !important; }
.buttons { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
.buttons button { padding: 8px 16px; border: none; border-radius: 8px; background: #7C4DFF; color: #fff; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
.buttons button:hover { background: #9F7AEA; transform: translateY(-2px); }
.item { display: flex; width: 45%; align-items: center; justify-content: space-between; margin-bottom: 2px; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.8); transition: all 0.2s ease; }
.item:hover { background: rgba(255,255,255,0.5); }
.item img { width: 28px; height: 28px; margin-right: 12px; border-radius: 4px; }
.item .actions { display: flex; gap: 6px; }
.item button, .product-card button { border: none; padding: 3px 8px 6px 8px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; }
.item div { display: flex; align-items: center; }
.edit { background: #7C4DFF; color: #fff; }
.delete { background: #EF5350; color: #fff; }
#productMaterials > div { display: flex; gap: 10px; margin-bottom: 10px; }
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; }
.modal.hidden { display: none !important; }
.modal-content { background: #3B1E87; color: #E0E7FF; padding: 25px; border-radius: 15px; width: 400px; max-width: 90%; max-height: 80vh; overflow-y: auto; border: 2px solid #7C4DFF; box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
.modal-content h3 { margin: 0 0 15px; font-size: 1.5rem; color: #fff; }
.modal-content label { display: block; margin: 12px 0 15px; font-weight: 500; }
.modal-content input, .modal-content select { width: 100%; padding: 10px; border: 1px solid #7C4DFF; border-radius: 8px; background: rgba(255,255,255,0.1); color: #E0E7FF; font-size: 1rem; box-sizing: border-box; }
.modal-content input:focus, .modal-content select:focus { outline: none; border-color: #B388FF; box-shadow: 0 0 5px rgba(179,136,255,0.5); }
.modal-content button { padding: 10px 20px; margin: 15px 5px 0 0; border: none; border-radius: 8px; background: #7C4DFF; color: #fff; cursor: pointer; font-weight: 600; transition: all 0.3s ease; }
.modal-content button:hover { background: #9F7AEA; transform: translateY(-2px); }
.modal-content button:last-child { background: #EF5350; }
.modal-content button:last-child:hover { background: #FF6E6B; }
#productsList, #materialsList { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; }
.product-card { display: flex; flex-direction: column; background: rgba(255,255,255,0.1); border: 2px solid #7C4DFF; border-radius: 15px; overflow: hidden; width: 45%; min-width: 320px; max-width: 100%; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: all 0.3s ease; position: relative; }
.product-card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.3); }
.product-image { position: relative; width: 100%; height: 200px; overflow: hidden; }
.product-image img { width: 100%; height: 100%; object-fit: cover; }
.product-title { position: absolute; bottom: 0; left: 0; width: 100%; padding: 8px 12px; background: linear-gradient(to top, rgba(0,0,0,0.6), rgba(0,0,0,0.04)); color: #fff; font-size: 1rem; font-weight: 600; box-sizing: border-box; }
.card-actions { display: flex; gap: 6px; position: absolute; top: 8px; right: 8px; }
.product-info { flex: 1; background: #fff; color: #333; padding: 10px; font-size: 13px; }
.resources { margin-top: 10px; }
.resource { display: flex; align-items: center; margin-bottom: 6px; }
.resource img { width: 20px; height: 20px; margin-right: 8px; }
.resource-name, .resource-price { flex: 0 0 auto; }
.dots { flex: 1; border-bottom: 1px dotted #aaa; margin: 0 6px; }
.resource-price { font-weight: 500; }
.total { margin-top: 12px; font-weight: 700; font-size: 1.1rem; text-align: right; }
</style>
</head>
<body>

<div class="tabs">
  <div class="tab active" data-tab="products">–¢–æ–≤–∞—Ä—ã</div>
  <div class="tab" data-tab="materials">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
</div>

<div id="products" class="tab-content">
  <div class="buttons">
    <button id="addProductBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
    <button id="loadProductBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    <button id="saveProductBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <input type="file" id="productFileInput" accept="application/json" style="display:none">
  </div>
  <div id="productsList"></div>
</div>

<div id="materials" class="tab-content hidden">
  <div class="buttons">
    <button id="addMaterialBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
    <button id="loadMaterialBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    <button id="saveMaterialBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <input type="file" id="materialFileInput" accept="application/json" style="display:none">
  </div>
  <div id="materialsList"></div>
</div>

<div id="materialModal" class="modal hidden">
  <div class="modal-content">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ: <input type="text" id="materialName"></label>
    <label>URL –∏–∫–æ–Ω–∫–∏: <input type="text" id="materialIcon"></label>
    <label>–¶–µ–Ω–∞: <input type="number" id="materialPrice"></label>
    <div>
      <button id="saveMaterial">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id="cancelMaterial">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<div id="productModal" class="modal hidden">
  <div class="modal-content">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ: <input type="text" id="productName"></label>
    <label>URL –∫–∞—Ä—Ç–∏–Ω–∫–∏: <input type="text" id="productIcon"></label>
    <div id="productMaterials"></div>
    <button id="addProductMaterial">–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</button>
    <div>
      <button id="saveProduct">–ì–æ—Ç–æ–≤–æ</button>
      <button id="cancelProduct">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<script>
const defaultMaterials = [
  { name: "–ü–ª–∞—Å—Ç–∏–∫ TPU (–∫–≥)", icon: "plastic-tpu.png", price: 1800 },
  { name: "–ü–ª–∞—Å—Ç–∏–∫ TPU (–º–µ—Ç—Ä)", icon: "plastic-tpu.png", price: 5.63 },
  { name: "–ü–ª–∞—Å—Ç–∏–∫ ABS (–∫–≥)", icon: "plastic-abs.png", price: 1500 },
  { name: "–ü–ª–∞—Å—Ç–∏–∫ ABS (–º–µ—Ç—Ä)", icon: "plastic-abs.png", price: 4.69 },
  { name: "–ü–ª–∞—Å—Ç–∏–∫ PETG (–∫–≥)", icon: "plastic-petg.png", price: 1200 },
  { name: "–ü–ª–∞—Å—Ç–∏–∫ PETG (–º–µ—Ç—Ä)", icon: "plastic-petg.png", price: 3.75 },
  { name: "–ü–ª–∞—Å—Ç–∏–∫ PLA (–º–µ—Ç—Ä)", icon: "plastic-pla.png", price: 2.82 },
  { name: "–ü–ª–∞—Å—Ç–∏–∫ PLA (–∫–≥)", icon: "plastic-pla.png", price: 900 },
  { name: "–ß–∞—Å —Ä–∞–±–æ—Ç—ã", icon: "jobprice.png", price: 7 }
];

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
let materials = [];
try {
  const storedMaterials = JSON.parse(localStorage.getItem("materials"));
  if (Array.isArray(storedMaterials) && storedMaterials.length > 0) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
    materials = [...storedMaterials];
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏–∑ defaultMaterials, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –≤ storedMaterials
    defaultMaterials.forEach(defaultMat => {
      if (!materials.some(m => m.name === defaultMat.name)) {
        materials.push({ ...defaultMat });
      }
    });
  } else {
    // –ï—Å–ª–∏ localStorage –ø—É—Å—Ç –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º defaultMaterials
    materials = [...defaultMaterials];
  }
} catch (e) {
  // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º defaultMaterials
  materials = [...defaultMaterials];
}

let products = [];
try {
  const storedProducts = JSON.parse(localStorage.getItem("products"));
  products = Array.isArray(storedProducts) ? storedProducts : [];
} catch (e) {
  products = [];
}

let editingMaterialIndex = null;
let editingProductIndex = null;

function saveMaterials() {
  localStorage.setItem("materials", JSON.stringify(materials));
}

function saveProducts() {
  localStorage.setItem("products", JSON.stringify(products));
}

function renderMaterials() {
  const list = document.getElementById("materialsList");
  list.innerHTML = "";
  materials.forEach((m, index) => {
    const div = document.createElement("div");
    div.className = "item";
    const left = document.createElement("div");
    const img = document.createElement("img");
    img.src = m.icon || "noimage.jpg";
    const span = document.createElement("span");
    span.textContent = `${m.name} ‚Äî ${m.price}üíµ`;
    left.appendChild(img);
    left.appendChild(span);

    const actions = document.createElement("div");
    actions.className = "actions";

    const editBtn = document.createElement("button");
    editBtn.textContent = "‚úèÔ∏è";
    editBtn.className = "edit";
    editBtn.addEventListener("click", () => {
      editingMaterialIndex = index;
      document.getElementById("materialName").value = m.name;
      document.getElementById("materialIcon").value = m.icon;
      document.getElementById("materialPrice").value = m.price;
      document.getElementById("materialModal").classList.remove("hidden");
    });

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "‚ùå";
    deleteBtn.className = "delete";
    deleteBtn.addEventListener("click", () => {
      materials.splice(index, 1);
      saveMaterials();
      renderMaterials();
      renderProducts();
    });

    actions.appendChild(editBtn);
    actions.appendChild(deleteBtn);

    div.appendChild(left);
    div.appendChild(actions);
    list.appendChild(div);
  });
}

function renderProducts() {
  const list = document.getElementById("productsList");
  list.innerHTML = "";

  products.forEach((p, index) => {
    const card = document.createElement("div");
    card.className = "product-card";

    const imageDiv = document.createElement("div");
    imageDiv.className = "product-image";

    const img = document.createElement("img");
    img.src = p.icon || "noimage.jpg";

    const title = document.createElement("div");
    title.className = "product-title";

    const titleText = document.createElement("span");
    titleText.className = "title-text";
    titleText.textContent = p.name;

    const actions = document.createElement("div");
    actions.className = "card-actions";

    const editBtn = document.createElement("button");
    editBtn.textContent = "‚úé";
    editBtn.className = "edit-product";
    editBtn.addEventListener("click", () => {
      editingProductIndex = index;
      document.getElementById("productModal").classList.remove("hidden");
      document.getElementById("productName").value = p.name;
      document.getElementById("productIcon").value = p.icon;
      const container = document.getElementById("productMaterials");
      container.innerHTML = "";
      p.resources.forEach(r => {
        const row = document.createElement("div");
        const select = document.createElement("select");
        materials.forEach(m => {
          const option = document.createElement("option");
          option.value = m.name;
          option.textContent = m.name;
          if (m.name === r.material) option.selected = true;
          select.appendChild(option);
        });
        const qty = document.createElement("input");
        qty.type = "number";
        qty.min = 1;
        qty.value = r.quantity;
        row.appendChild(select);
        row.appendChild(qty);
        container.appendChild(row);
      });
    });

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "üóë";
    deleteBtn.className = "delete-product";
    deleteBtn.addEventListener("click", () => {
      products = products.filter(prod => prod !== p);
      saveProducts();
      renderProducts();
    });

    actions.appendChild(editBtn);
    actions.appendChild(deleteBtn);

    title.appendChild(titleText);
    title.appendChild(actions);

    imageDiv.appendChild(img);
    imageDiv.appendChild(title);

    const info = document.createElement("div");
    info.className = "product-info";

    const resourcesDiv = document.createElement("div");
    resourcesDiv.className = "resources";
    let total = 0;

    p.resources.forEach(r => {
      const mat = materials.find(m => m.name === r.material);
      const resDiv = document.createElement("div");
      resDiv.className = "resource";

      const resImg = document.createElement("img");
      const nameSpan = document.createElement("span");
      nameSpan.className = "resource-name";
      const dots = document.createElement("span");
      dots.className = "dots";
      const priceSpan = document.createElement("span");
      priceSpan.className = "resource-price";

      if (mat) {
        const cost = mat.price * r.quantity;
        total += cost;
        resImg.src = mat.icon || "noimage.jpg";
        nameSpan.textContent = mat.name;
        priceSpan.textContent = `${mat.price}üíµ √ó ${r.quantity} = ${cost}üíµ`;
      } else {
        resImg.src = "noimage.jpg";
        nameSpan.textContent = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
        priceSpan.textContent = `√ó${r.quantity}`;
      }

      resDiv.appendChild(resImg);
      resDiv.appendChild(nameSpan);
      resDiv.appendChild(dots);
      resDiv.appendChild(priceSpan);

      resourcesDiv.appendChild(resDiv);
    });

    const totalDiv = document.createElement("div");
    totalDiv.className = "total";
    totalDiv.textContent = "–ò—Ç–æ–≥–æ: " + total + " (+~" + (total * 0.02) + ") üíµ";

    info.appendChild(resourcesDiv);
    info.appendChild(totalDiv);

    card.appendChild(imageDiv);
    card.appendChild(info);
    list.appendChild(card);
  });
}

document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    document.querySelectorAll(".tab-content").forEach(c => c.classList.add("hidden"));
    document.getElementById(tab.dataset.tab).classList.remove("hidden");
  });
});

document.getElementById("addMaterialBtn").addEventListener("click", () => {
  editingMaterialIndex = null;
  document.getElementById("materialName").value = "";
  document.getElementById("materialIcon").value = "";
  document.getElementById("materialPrice").value = "";
  document.getElementById("materialModal").classList.remove("hidden");
});

document.getElementById("cancelMaterial").addEventListener("click", () => {
  document.getElementById("materialModal").classList.add("hidden");
  document.getElementById("materialName").value = "";
  document.getElementById("materialIcon").value = "";
  document.getElementById("materialPrice").value = "";
});

document.getElementById("saveMaterial").addEventListener("click", () => {
  const name = document.getElementById("materialName").value.trim();
  const icon = document.getElementById("materialIcon").value.trim();
  const price = parseFloat(document.getElementById("materialPrice").value);
  if (!name || isNaN(price)) {
    alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É –º–∞—Ç–µ—Ä–∏–∞–ª–∞!");
    return;
  }

  if (editingMaterialIndex !== null) {
    materials[editingMaterialIndex] = { name, icon, price };
  } else {
    if (materials.some(m => m.name === name)) {
      alert("–ú–∞—Ç–µ—Ä–∏–∞–ª —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!");
      return;
    }
    materials.push({ name, icon, price });
  }
  saveMaterials();
  renderMaterials();
  renderProducts();
  document.getElementById("materialModal").classList.add("hidden");
});

document.getElementById("saveMaterialBtn").addEventListener("click", () => {
  try {
    const blob = new Blob([JSON.stringify(materials, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "materials.json";
    a.click();
    URL.revokeObjectURL(a.href);
    alert("–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª!");
  } catch (e) {
    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤!");
    console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:", e);
  }
});

document.getElementById("loadMaterialBtn").addEventListener("click", () => {
  document.getElementById("materialFileInput").click();
});

document.getElementById("materialFileInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = evt => {
    try {
      const data = JSON.parse(evt.target.result);
      if (Array.isArray(data)) {
        const newMaterials = [];
        data.forEach(m => {
          if (m.name && !isNaN(m.price)) {
            newMaterials.push({ name: m.name, icon: m.icon || "", price: m.price });
          }
        });
        materials = [...newMaterials]; // –ó–∞–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–æ–≤—ã–º–∏
        saveMaterials();
        renderMaterials();
        renderProducts();
        alert("–ú–∞—Ç–µ—Ä–∏–∞–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!");
      } else {
        alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞!");
      }
    } catch {
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤!");
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤");
    }
    e.target.value = ""; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ input
  };
  reader.readAsText(file);
});

document.getElementById("addProductBtn").addEventListener("click", () => {
  editingProductIndex = null;
  document.getElementById("productName").value = "";
  document.getElementById("productIcon").value = "";
  document.getElementById("productMaterials").innerHTML = "";
  document.getElementById("productModal").classList.remove("hidden");
});

document.getElementById("cancelProduct").addEventListener("click", () => {
  document.getElementById("productModal").classList.add("hidden");
  document.getElementById("productName").value = "";
  document.getElementById("productIcon").value = "";
  document.getElementById("productMaterials").innerHTML = "";
  editingProductIndex = null;
});

document.getElementById("addProductMaterial").addEventListener("click", () => {
  const container = document.createElement("div");
  const select = document.createElement("select");
  materials.forEach(m => {
    const option = document.createElement("option");
    option.value = m.name;
    option.textContent = m.name;
    select.appendChild(option);
  });
  const qty = document.createElement("input");
  qty.type = "number";
  qty.min = 1;
  qty.value = 1;
  container.appendChild(select);
  container.appendChild(qty);
  document.getElementById("productMaterials").appendChild(container);
});

document.getElementById("saveProduct").addEventListener("click", () => {
  const name = document.getElementById("productName").value.trim();
  const icon = document.getElementById("productIcon").value.trim();
  const resources = [];
  document.querySelectorAll("#productMaterials div").forEach(div => {
    const material = div.querySelector("select").value;
    const quantity = parseInt(div.querySelector("input").value);
    if (material && quantity > 0) {
      resources.push({ material, quantity });
    }
  });
  if (!name) {
    alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞!");
    return;
  }

  if (editingProductIndex !== null) {
    products[editingProductIndex] = { name, icon, resources };
  } else {
    if (products.some(p => p.name === name)) {
      alert("–ü—Ä–æ–¥—É–∫—Ç —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!");
      return;
    }
    products.push({ name, icon, resources });
  }
  saveProducts();
  renderProducts();
  document.getElementById("productModal").classList.add("hidden");
  editingProductIndex = null;
});

document.getElementById("saveProductBtn").addEventListener("click", () => {
  try {
    const blob = new Blob([JSON.stringify(products, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "products.json";
    a.click();
    URL.revokeObjectURL(a.href);
    alert("–ü—Ä–æ–¥—É–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª!");
  } catch (e) {
    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤!");
    console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤:", e);
  }
});

document.getElementById("loadProductBtn").addEventListener("click", () => {
  document.getElementById("productFileInput").click();
});

document.getElementById("productFileInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = evt => {
    try {
      const data = JSON.parse(evt.target.result);
      if (Array.isArray(data)) {
        products = data.filter(p => p.name && Array.isArray(p.resources));
        saveProducts();
        renderProducts();
        alert("–ü—Ä–æ–¥—É–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!");
      } else {
        alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞!");
      }
    } catch {
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤!");
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤");
    }
    e.target.value = ""; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ input
  };
  reader.readAsText(file);
});

renderMaterials();
renderProducts();
</script>
</body>
</html>

